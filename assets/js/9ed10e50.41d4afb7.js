"use strict";(self.webpackChunkwechat_assistant_pro_docs=self.webpackChunkwechat_assistant_pro_docs||[]).push([[1714],{3417:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var t=s(4848),r=s(8453);const a={sidebar_position:5},o="\u56de\u8c03\u4e8b\u4ef6",i={id:"features/callback_event",title:"\u56de\u8c03\u4e8b\u4ef6",description:"\u901a\u8fc7\u81ea\u5b9a\u4e49\u5173\u952e\u5b57\u3001\u7528\u6237\u7c7b\u578b\u7b49\u914d\u7f6e\uff0c\u63d0\u4f9b\u66f4\u4e30\u5bcc\u7684\u529f\u80fd\u6269\u5c55\u3002",source:"@site/docs/features/callback_event.md",sourceDirName:"features",slug:"/features/callback_event",permalink:"/docs/features/callback_event",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"\u7fa4\u53d1\u52a9\u624b",permalink:"/docs/features/message_broadcast"},next:{title:"\u5b9a\u65f6\u63d0\u9192",permalink:"/docs/features/scheduler"}},c={},l=[{value:"\u5217\u8868\u9875",id:"\u5217\u8868\u9875",level:2},{value:"\u53c2\u6570\u914d\u7f6e",id:"\u53c2\u6570\u914d\u7f6e",level:2},{value:"\u81ea\u5b9a\u4e49\u56de\u8c03\u5730\u5740",id:"\u81ea\u5b9a\u4e49\u56de\u8c03\u5730\u5740",level:2},{value:"\u8bf7\u6c42\u53c2\u6570",id:"\u8bf7\u6c42\u53c2\u6570",level:3},{value:"\u54cd\u5e94\u53c2\u6570",id:"\u54cd\u5e94\u53c2\u6570",level:3},{value:"\u6d88\u606f\u7c7b\u578b\u8bf4\u660e",id:"\u6d88\u606f\u7c7b\u578b\u8bf4\u660e",level:3},{value:"\u793a\u4f8b\u4ee3\u7801",id:"\u793a\u4f8b\u4ee3\u7801",level:3}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u56de\u8c03\u4e8b\u4ef6",children:"\u56de\u8c03\u4e8b\u4ef6"})}),"\n",(0,t.jsx)(n.p,{children:"\u901a\u8fc7\u81ea\u5b9a\u4e49\u5173\u952e\u5b57\u3001\u7528\u6237\u7c7b\u578b\u7b49\u914d\u7f6e\uff0c\u63d0\u4f9b\u66f4\u4e30\u5bcc\u7684\u529f\u80fd\u6269\u5c55\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u5217\u8868\u9875",children:"\u5217\u8868\u9875"}),"\n",(0,t.jsx)(n.p,{children:"\u67e5\u770b\u5df2\u914d\u7f6e\u7684\u56de\u8c03\u4e8b\u4ef6\u5217\u8868\uff0c\u53ef\u4ee5\u7f16\u8f91\u6216\u5220\u9664\u5df2\u914d\u7f6e\u7684\u56de\u8c03\u4e8b\u4ef6\u3002"}),"\n",(0,t.jsx)("img",{src:"/img/software_callback_event_01_mosaic.png",width:"500"}),"\n",(0,t.jsx)(n.h2,{id:"\u53c2\u6570\u914d\u7f6e",children:"\u53c2\u6570\u914d\u7f6e"}),"\n",(0,t.jsx)(n.p,{children:"\u914d\u7f6e\u56de\u8c03\u4e8b\u4ef6\u7684\u540d\u79f0\u3001\u5173\u952e\u5b57\u3001\u7528\u6237\u7c7b\u578b\u3001\u89e6\u53d1\u6761\u4ef6\u7b49\u53c2\u6570\u3002"}),"\n",(0,t.jsx)("img",{src:"/img/software_callback_event_02_mosaic.png",width:"500"}),"\n",(0,t.jsx)(n.h2,{id:"\u81ea\u5b9a\u4e49\u56de\u8c03\u5730\u5740",children:"\u81ea\u5b9a\u4e49\u56de\u8c03\u5730\u5740"}),"\n",(0,t.jsx)(n.h3,{id:"\u8bf7\u6c42\u53c2\u6570",children:"\u8bf7\u6c42\u53c2\u6570"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface CallbackMesssagePayload {\n  type: MessageType;\n  id: string;\n\n  filename?: string;\n  text?: string;\n\n  talkerId: string;\n  listenerId?: string;\n\n  roomId: string;\n  mentionIdList?: string[]; // Mentioned Contacts' Ids\n\n  timestamp: number;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface RunEventTaskProps {\n  question: string;\n  userId: string;\n  isSelf: boolean;\n  variables?: Record<string, string>;\n  payload?: CallbackMesssagePayload;\n}\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\u6ce8\u610f\uff1a",(0,t.jsx)(n.code,{children:"CallbackMesssagePayload"})," \u4e3a wechaty \u6807\u51c6\u6d88\u606f\u7c7b\u578b\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u54cd\u5e94\u53c2\u6570",children:"\u54cd\u5e94\u53c2\u6570"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface RunEventTaskResponse {\n  success: boolean;\n  message: string;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u6d88\u606f\u7c7b\u578b\u8bf4\u660e",children:"\u6d88\u606f\u7c7b\u578b\u8bf4\u660e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"enum MessageType {\n  Unknown = 0,\n\n  Attachment = 1, // Attach(6),\n  Audio = 2, // Audio(1), Voice(34)\n  Contact = 3, // ShareCard(42)\n  ChatHistory = 4, // ChatHistory(19)\n  Emoticon = 5, // Sticker: Emoticon(15), Emoticon(47)\n  Image = 6, // Img(2), Image(3)\n  Text = 7, // Text(1)\n  Location = 8, // Location(48)\n  MiniProgram = 9, // MiniProgram(33)\n  GroupNote = 10, // GroupNote(53)\n  Transfer = 11, // Transfers(2000)\n  RedEnvelope = 12, // RedEnvelopes(2001)\n  Recalled = 13, // Recalled(10002)\n  Url = 14, // Url(5)\n  Video = 15, // Video(4), Video(43)\n  Post = 16, // Moment, Channel, Tweet, etc\n\n  System = 18 // System Message\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u793a\u4f8b\u4ee3\u7801",children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,t.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\u4ee3\u7801\uff0c\u4f7f\u7528 Express \u6846\u67b6\u5b9e\u73b0\u56de\u8c03\u5730\u5740\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import express from 'express';\nimport dayjs from 'dayjs';\n\nconst app = express();\n\napp.use(express.json());\n\napp.get('/', (req, res) => {\n  res.send('Hello World!');\n});\n\napp.post('/user/subscribe', (req, res) => {\n  console.log('-'.repeat(50))\n  console.log(dayjs().format('YYYY-MM-DD HH:mm:ss'))\n  console.log(req.body);\n\n  res.json({\n    success: true,\n    message: 'ok'\n  })\n})\n\napp.listen(4000, () => {\n  console.log('Example app listening on port 4000!');\n});\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>i});var t=s(6540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);